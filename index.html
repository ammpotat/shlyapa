<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Shopping Markers</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/jeromeetienne/AR.js/master/aframe/build/aframe-ar.js"></script>
    <style>
        body { margin: 0; }
        #instructions {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            font-size: 20px;
        }
    </style>
</head>
<body style="margin: 0; overflow: hidden;">
    <div id="instructions">Наведите камеру на здание с магазином</div>
    
    <a-scene embedded arjs='sourceType: webcam;'>
        <a-marker id="marker" preset="hiro">
            <a-entity id="shop-sphere" geometry="primitive: sphere; radius: 0.1" material="color: red"></a-entity>
        </a-marker>

        <a-entity camera></a-entity>
    </a-scene>

    <script>
        const apiKey = 'AIzaSyD_Wxax3TyBaYzb7NAMdS4iXWkxPFffnO8'; // Замените на ваш ключ API
        let userLocation = null;

        // Функция для получения геолокации
        function getLocation() {
            return new Promise((resolve, reject) => {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            userLocation = {
                                lat: position.coords.latitude,
                                lng: position.coords.longitude
                            };
                            resolve(userLocation);
                        },
                        (error) => {
                            reject(error);
                        }
                    );
                } else {
                    reject(new Error("Геолокация не поддерживается вашим браузером."));
                }
            });
        }

        async function fetchShops() {
            if (!userLocation) return [];
            const response = await fetch(https://maps.googleapis.com/maps/api/place/nearbysearch/json?location=${userLocation.lat},${userLocation.lng}&radius=1500&type=store&key=${apiKey});
            const data = await response.json();
            return data.results;
        }

        document.querySelector('#marker').addEventListener('markerFound', async () => {
            try {
                await getLocation(); // Получаем геолокацию
                const shops = await fetchShops(); // Получаем магазины
                if (shops.length > 0) {
                    const shop = shops[0];
                    console.log('Найден магазин:', shop.name);
                    
                    // Изменяем цвет сферы, чтобы она обозначала наличие магазина
                    const sphere = document.querySelector('#shop-sphere');
                    sphere.setAttribute('material', 'color: green');
                    sphere.setAttribute('position', '0 0.5 0'); // Можно изменить позицию при необходимости
                } else {
                    console.log('Магазины не найдены');
                }
            } catch (error) {
                console.error('Ошибка:', error.message);
            }
        });
    </script>
</body>
</html>
